# Technical Documentation

## 1. Project Overview
This document provides a technical overview of the Inventory Management Flutter application. It is intended for developers who will be working on or maintaining the codebase.

## 2. Architecture
The project follows the principles of **Clean Architecture**. The code is organized into three main layers to ensure separation of concerns, testability, and maintainability. The layers are located in `lib/`:

-   **`domain`**: The core of the application. It contains the business logic, entities, and repository interfaces. This layer is independent of any UI or data-source-specific implementation.
    -   `entities/`: Plain Dart objects representing the core models (e.g., `Product`, `Material`).
    -   `repositories/`: Abstract classes (interfaces) that define the contract for data operations (e.g., `IProductRepository`).
    -   `services/`: Classes that contain business logic, such as `ReportService`.

-   **`data`**: Implements the repository interfaces defined in the domain layer. It handles the actual data operations.
    -   `datasources/local/`: Contains the database setup (`database.dart`) using the `drift` package.
    -   `repositories/`: Contains the concrete implementations of the repository interfaces (e.g., `ProductRepositoryImpl`). These classes are responsible for calling the DAOs and mapping data between the database models and domain entities.

-   **`presentation`**: The UI layer of the application, built with Flutter.
    -   `providers/`: Contains all the Riverpod providers for state management and dependency injection.
    -   `screens/`: Contains the individual UI screens for each feature.
    -   `app_router.dart`: Defines the application's navigation using the `go_router` package.

## 3. State Management
State management is handled using the **Riverpod** package (`flutter_riverpod`). A centralized file, `presentation/providers/application_providers.dart`, contains all the providers for the application.

The dependency injection chain is set up as follows:
`Database Provider` -> `DAO Providers` -> `Repository Providers` -> `Service Providers` -> `UI Widgets`

UI widgets (which are `ConsumerWidget` or `ConsumerStatefulWidget`) `watch` or `read` these providers to get access to data and services. For reactive UI, screens watch `StreamProvider`s (e.g., `productsStreamProvider`) which are connected to `watch` methods in the Drift DAOs.

## 4. Data Persistence
Local data persistence is managed by the **Drift** package (a reactive persistence library for Flutter).

-   **Schema Definition**: The database tables, DAOs, and database class are all defined in `data/datasources/local/database.dart`.
-   **Tables**: The database consists of four tables: `Products`, `Materials`, `ProductMaterials` (join table), and `ProductionLogs`.
-   **DAOs (Data Access Objects)**: Each table has a corresponding DAO that encapsulates all its query logic.
-   **Generated Code**: The file `database.g.dart` is normally generated by `build_runner`. **Note:** Due to a persistent issue with the build environment, this file was manually written and updated during development.

## 5. Navigation
Navigation is handled by the **GoRouter** package.
-   All routes are defined in `presentation/app_router.dart`.
-   The router configuration is exposed via a Riverpod provider (`goRouterProvider`) and consumed in `main.dart`.
-   Routes are structured hierarchically (e.g., `/products/add` is a sub-route of `/products`).

## 6. Key Services

-   **`ReportService` (`domain/services/report_service.dart`)**: Contains the business logic for calculating the material usage reports. It takes the necessary repositories as dependencies and performs calculations based on the production log and product-material mappings.
-   **`ExportService` (`domain/services/export_service.dart`)**: Contains the logic for generating PDF and CSV files from report data. It uses the `pdf` and `csv` packages.

## 7. Known Issues & Future Development

-   **Build Environment**: The `build_runner` command fails consistently due to a dependency conflict with `custom_lint_core`. This prevents all code generation (`drift`, `mockito`, `riverpod_generator`). Any work on this project must account for the need to manually update generated files. Resolving this environment issue is a top priority for future development.
-   **Web Backend**: The application currently only supports a local, mobile database. The web backend feature (REST API, PostgreSQL/MySQL) has not been implemented.
-   **CSV Export UX**: The CSV export currently displays the data in a dialog for copying. A future improvement would be to save the data directly to a `.csv` file.
-   **Testing**: The testing step was skipped due to the build runner issue preventing mock generation. A comprehensive suite of unit, widget, and integration tests should be added once the build environment is fixed.
